var searchBox = document.querySelector(".search-page .searchBox");
var searchList = document.querySelector(".search-page .searchResults ul");
var searchForm = document.querySelector(".search-page form");

searchForm.onsubmit = function(event) {
    event.preventDefault();
}

searchBox.onkeyup = function (event) {
    if (searchBox.value != "") {
        searchInput(searchBox.value, event);
    }
}

var searchInput = function(searchText, event) {
    cursorPosition = searchBox.selectionStart;
    searchList.innerHTML = "";
    if (resumeData[0][searchText]) {
        findData(resumeData[0][searchText], searchList);
    }
    else {
        for (key in resumeData[0]) {
            if (event.key != "Backspace") {
                if (key.startsWith(searchText)) {
                    searchBox.value = key;
                }
                for (keyDeep in resumeData[0][key]) {
                    if (((typeof(resumeData[0][key]) === "object" ||
                        typeof(resumeData[0][key]) === "array")) && 
                        keyDeep.startsWith(searchText)) {
                        searchBox.value = keyDeep;
                    }
                }
                searchBox.setSelectionRange(cursorPosition, searchBox.value.length);
            }

            if (resumeData[0][key][searchText]) {
                findData(resumeData[0][key][searchText], searchList);
            }
        }
    }
}

var findData = function (objectElement, parentList) {
    if (typeof(objectElement) === "string") {
        var listElement = document.createElement("li");
        var listBullet = document.createElement("i");
        listBullet.setAttribute("class", "fa-li fa fa-angle-right");
        listElement.appendChild(listBullet)

        var textLabel = document.createTextNode(objectElement);
        listElement.appendChild(textLabel);

        parentList.appendChild(listElement);
    } else {
        for (key in objectElement) {
            if (typeof(objectElement[key]) === "object" || 
                typeof(objectElement[key]) === "array") {
                var listElement = document.createElement("li");
                var listBullet = document.createElement("i");
                listBullet.setAttribute("class", "fa-li fa fa-angle-right");
                listElement.appendChild(listBullet)

                var textLabel = document.createTextNode(key);
                listElement.appendChild(textLabel);

                parentList.appendChild(listElement);
                
                var ulList = document.createElement("ul");
                ulList.setAttribute("class", "fa-ul");
                listElement.appendChild(ulList);
                findData(objectElement[key], ulList);
            } else if (typeof(objectElement[key]) === "string") {
                var listElement = document.createElement("li");
                var listBullet = document.createElement("i");
                listBullet.setAttribute("class", "fa-li fa fa-angle-right");
                listElement.appendChild(listBullet)

                var textLabel = document.createTextNode(objectElement[key]);
                listElement.appendChild(textLabel);

                parentList.appendChild(listElement);
            }
        }
    }
}
resumeData = [{
    "name": "Mihir Patel",
    "contact": {
        "phone": "513-720-9908",
        "email": "patel3mh@mail.uc.edu"
    },
    "education": {
        "university" : {
            "name": "University of Cincinnati",
            "location": "Cincinnati, Ohio",
            "graduation year": "Class of 2021",
            "major": "Bachelor of Science in Computer Science"
        },
        "high school": {
            "name": "Fairfield High School",
            "location": "Fairfield, Ohio",
            "graduation year": "2016"
        }
    },
    "skills": {
        "programming": [
            "C++",
            "JavaScript (ES6)",
            "Python",
            "HTML",
            "CSS",
            "Sass",
            "MATLAB",
            "PHP"
        ],
        "frameworks": [
            "TensorFlow",
            "Angular",
            "Drupal",
            "Bootstrap",
            "Flask",
            "PyQt",
            "Agile (SCRUM)"
        ],
        "tools" : [
            "Amazon Web Services",
            "Docker",
            "Git",
            "Elasticsearch",
            "Gulp",
            "JQuery",
            "Adobe Creative Suite"
        ]
    },
    "experiences": {
        "Siemens PLM Software": {
            "title": "Software Development Co-op",
            "location": "Milford, Ohio",
            "dates": "Jan 2018 - Present",
            "description": [
                "Utilize TensorFlow to forge a CNN model to classify data with over 90% accuracy",
                "Automate machine learning training by extending use of various C++ APIs",
                "Query textual data from Elasticsearch utilizing JavaScript APIs",
                "Embed AWS Lambda JavaScript calls in an Angular web framework",
                "Responsible for utilizing Python to parse CSVs to index data into Elasticsearch",
                "Create a Python Flask REST API to handle up to 500 requests in a Docker container"
            ],
            "technical skill": "During my first co-op term at Siemens PLM Software, I was tasked to come up with a proof of concept for a piece of software utilizing machine learning. TensorFlow was the machine learning framework I had to use to develop the software. Once the proof of concept was complete, I was able to get the opportunity to demo it to a customer to receive feedback. Since I was utilizing tools I had not used in the past, going through documentation and learning the structure of the tool was a technical skill I had gained. This was important as the tech industry is always evolving and it's likely I will have to learn new tools many times throughout my career. Presenting my ideas at meetings and in front of customers was a non-technical skill I had acquired. I will need to present my ideas thoroughly to be able to succeed in this field.",
            "nontechnical skill": "Once I got to my second term, I was tasked to take the proof of concept I had developed in my first term and to turn into a production-ready application. I was able to use Docker to package the project to be easily deployable to customers. A technical skill I gained during this term about learning about the REST architectural style to create a RESTful application to transfer data between our main software and the software I had developed. REST is used throughout the industry as the main standard to transfer information across the internet. Web technologies is a large field software engineers play a role in which marks the significance of why this technical skill was important to me. A non-technical skill I had acquired was communicating with co-workers across the globe. It is important to be able to correctly relay information with co-workers who I may have a communication barrier due to time differences."
        },
        "University of Cincinnati": {
            "title": "First Year Experience Peer Leader",
            "location": "Cincinnati, Ohio",
            "dates": "Aug 2017 - Dec 2017",
            "description": [
                "Educated 20 students in topics across differing educational genres",
                "Created weekly lesson plans to accommodate university standards",
                "Engaged students by providing interactive presentations and activities"
            ]
        }
    }
}];